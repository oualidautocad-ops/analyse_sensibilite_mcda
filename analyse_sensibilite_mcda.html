<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse de Sensibilit√© MCDA - Calculateur</title>
    <style>
        /* Styles de base pour simuler une interface moderne (sans Tailwind/Shadcn) */
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f9; color: #333; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 30px; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 0; }
        .tab-controls { display: flex; margin-bottom: 20px; }
        .tab-controls button { flex-grow: 1; padding: 10px 20px; border: none; background-color: #e9ecef; color: #495057; cursor: pointer; border-radius: 4px 4px 0 0; transition: background-color 0.3s; }
        .tab-controls button.active { background-color: #007bff; color: white; }
        .input-section, .results-section { margin-top: 20px; }
        
        /* Configuration et Poids */
        .config-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: #e6f3ff; border-radius: 6px; }
        .weights-input, .names-input { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .weight-item, .name-item { flex: 1 1 180px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; }
        .weight-item input, .name-item input { width: 100%; box-sizing: border-box; padding: 5px; border: 1px solid #ddd; border-radius: 3px; }
        #weight-sum { font-weight: bold; margin-left: 20px; padding: 5px 10px; border-radius: 4px; }
        
        /* Matrice et Tableaux */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #dee2e6; padding: 8px; text-align: center; }
        th { background-color: #007bff; color: white; }
        td input { width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 3px; text-align: center; }
        
        /* Boutons */
        .action-buttons { margin-top: 20px; display: flex; gap: 15px; justify-content: flex-start; }
        .action-buttons button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        #analyze-btn { background-color: #28a745; color: white; }
        #analyze-btn:disabled { background-color: #adb5bd; cursor: not-allowed; }
        #reset-btn { background-color: #dc3545; color: white; }
        #export-csv-btn { background-color: #ffc107; color: #333; }
        
        /* Indicateurs */
        .robust-high { background-color: #d4edda; color: #155724; }
        .robust-medium { background-color: #fff3cd; color: #856404; }
        .robust-low { background-color: #f8d7da; color: #721c24; }
        .valid-sum { background-color: #d4edda; }
        .invalid-sum { background-color: #f8d7da; }
        .error-message { color: #dc3545; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üéØ Sensitivity Analyzer - MCDA Weight Bounds Calculator</h2>

    <div class="config-bar">
        <div id="dimensions-info">Dimensions actuelles : 7 Alternatives x 8 Crit√®res</div>
        <button onclick="showConfigModal()">‚öôÔ∏è Configurer Dimensions</button>
    </div>

    <div class="tab-controls">
        <button id="tab-input-btn" class="active" onclick="switchTab('input')">1. Saisie des Donn√©es</button>
        <button id="tab-results-btn" onclick="switchTab('results')" disabled>2. R√©sultats de l'Analyse</button>
    </div>

    <div id="input-tab" class="input-section">
        <h3>Poids des Crit√®res (Somme doit √™tre 1.0)</h3>
        <div class="weights-input" id="weights-container"></div>
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <label>Somme Totale :</label>
            <span id="weight-sum" class="invalid-sum">0.00</span>
        </div>
        
        <h3>Noms des Crit√®res</h3>
        <div class="names-input" id="criteria-names-container"></div>
        
        <h3>Noms des Alternatives</h3>
        <div class="names-input" id="alternatives-names-container"></div>

        <h3>Matrice des Valeurs Normalis√©es V<sub>ij</sub> (entre 0 et 1)</h3>
        <div id="matrix-container"></div>

        <p class="error-message" id="validation-error"></p>

        <div class="action-buttons">
            <button id="analyze-btn" onclick="runAnalysis()" disabled>üöÄ Analyser la Sensibilit√©</button>
            <button id="reset-btn" onclick="resetData()">üóëÔ∏è R√©initialiser</button>
        </div>
    </div>

    <div id="results-tab" class="results-section" style="display: none;">
        <h3>Classement Actuel</h3>
        <div id="ranking-results"></div>
        
        <h3 style="margin-top: 30px;">R√©sultats de Sensibilit√© (Intervalle de Stabilit√©)</h3>
        <div id="sensitivity-results"></div>

        <div class="action-buttons">
            <button id="export-csv-btn" onclick="exportResults()">‚¨áÔ∏è Exporter les R√©sultats (CSV)</button>
        </div>
    </div>
</div>

<div id="config-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 30px; border-radius: 8px; width: 350px;">
        <h3>Configurer les Dimensions</h3>
        <div style="margin-bottom: 15px;">
            <label for="num-criteria">Nombre de Crit√®res (2-20):</label>
            <input type="number" id="num-criteria" min="2" max="20" style="width: 100px; padding: 8px; border: 1px solid #ccc; margin-left: 10px;">
        </div>
        <div style="margin-bottom: 20px;">
            <label for="num-alternatives">Nombre d'Alternatives (2-20):</label>
            <input type="number" id="num-alternatives" min="2" max="20" style="width: 100px; padding: 8px; border: 1px solid #ccc; margin-left: 10px;">
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button onclick="hideConfigModal()" style="background: #6c757d; color: white;">Annuler</button>
            <button onclick="applyChanges()" style="background: #007bff; color: white;">Appliquer les Changements</button>
        </div>
    </div>
</div>

<script>
    // ----------------------------------------------------------------------------------
    // 1. D√âFINITION DES DONN√âES PAR D√âFAUT ET STRUCTURES
    // ----------------------------------------------------------------------------------
    
    const DEFAULT_CRITERIA_COUNT = 8;
    const DEFAULT_ALTERNATIVES_COUNT = 7;
    
    const DEFAULT_WEIGHTS = [0.15, 0.10, 0.05, 0.20, 0.10, 0.15, 0.15, 0.10];
    const DEFAULT_MATRIX = [
        [0.8, 0.2, 0.5, 0.9, 0.1, 0.7, 0.4, 0.6], 
        [0.5, 0.9, 0.1, 0.2, 0.8, 0.3, 0.7, 0.4], 
        [0.1, 0.5, 0.8, 0.3, 0.2, 0.9, 0.6, 0.7], 
        [0.9, 0.1, 0.2, 0.7, 0.5, 0.4, 0.8, 0.3], 
        [0.2, 0.8, 0.9, 0.1, 0.7, 0.6, 0.3, 0.5], 
        [0.7, 0.3, 0.4, 0.6, 0.9, 0.1, 0.5, 0.2], 
        [0.4, 0.7, 0.6, 0.5, 0.3, 0.2, 0.9, 0.1], 
    ];

    let state = {
        nCriteria: DEFAULT_CRITERIA_COUNT,
        nAlternatives: DEFAULT_ALTERNATIVES_COUNT,
        weights: [...DEFAULT_WEIGHTS],
        matrix: DEFAULT_MATRIX.map(row => [...row]),
        criterionNames: Array.from({ length: DEFAULT_CRITERIA_COUNT }, (_, i) => `C${i + 1}`),
        alternativeNames: Array.from({ length: DEFAULT_ALTERNATIVES_COUNT }, (_, i) => `A${i + 1}`),
        initialRankingIndices: [],
        sensitivityResults: [],
        rankingResults: [],
    };
    
    // ----------------------------------------------------------------------------------
    // 2. RENDU DE L'INTERFACE UTILISATEUR
    // ----------------------------------------------------------------------------------

    function renderInputUI() {
        document.getElementById('dimensions-info').textContent = 
            `${state.nAlternatives} Alternatives x ${state.nCriteria} Crit√®res`;
        
        renderWeights();
        renderNames();
        renderMatrix();
        checkWeightsSum();
    }

    function renderWeights() {
        const container = document.getElementById('weights-container');
        container.innerHTML = '';
        state.weights.forEach((w, j) => {
            const div = document.createElement('div');
            div.className = 'weight-item';
            div.innerHTML = `
                <label for="w${j}">${state.criterionNames[j]} (Poids):</label>
                <input type="number" id="w${j}" value="${w.toFixed(4)}" min="0" max="1" step="0.0001" onchange="updateWeight(${j}, this.value)">
            `;
            container.appendChild(div);
        });
    }
    
    function renderNames() {
        const cContainer = document.getElementById('criteria-names-container');
        cContainer.innerHTML = '';
        state.criterionNames.forEach((name, j) => {
            const div = document.createElement('div');
            div.className = 'name-item';
            div.innerHTML = `
                <label for="c_name${j}">Crit√®re ${j + 1}:</label>
                <input type="text" id="c_name${j}" value="${name}" onchange="updateCriterionName(${j}, this.value)">
            `;
            cContainer.appendChild(div);
        });
        
        const aContainer = document.getElementById('alternatives-names-container');
        aContainer.innerHTML = '';
        state.alternativeNames.forEach((name, i) => {
            const div = document.createElement('div');
            div.className = 'name-item';
            div.innerHTML = `
                <label for="a_name${i}">Alternative ${i + 1}:</label>
                <input type="text" id="a_name${i}" value="${name}" onchange="updateAlternativeName(${i}, this.value)">
            `;
            aContainer.appendChild(div);
        });
    }

    function renderMatrix() {
        const container = document.getElementById('matrix-container');
        container.innerHTML = '';

        let html = '<table><thead><tr><th>Alternative</th>';
        state.criterionNames.forEach(name => {
            html += `<th>${name}</th>`;
        });
        html += '</tr></thead><tbody>';

        state.matrix.forEach((row, i) => {
            html += `<tr><td>${state.alternativeNames[i]}</td>`;
            row.forEach((value, j) => {
                html += `<td><input type="number" value="${value.toFixed(4)}" min="0" max="1" step="0.0001" onchange="updateMatrixValue(${i}, ${j}, this.value)"></td>`;
            });
            html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // ----------------------------------------------------------------------------------
    // 3. LOGIQUE DE MISE √Ä JOUR DE L'√âTAT
    // ----------------------------------------------------------------------------------

    function updateWeight(index, value) {
        state.weights[index] = Math.max(0, parseFloat(value));
        checkWeightsSum();
    }
    
    function updateCriterionName(index, value) {
        state.criterionNames[index] = value;
        renderWeights(); // Re-render pour mettre √† jour les labels
        renderMatrix(); // Re-render pour mettre √† jour les headers
    }
    
    function updateAlternativeName(index, value) {
        state.alternativeNames[index] = value;
        renderMatrix(); // Re-render pour mettre √† jour les labels de ligne
    }

    function updateMatrixValue(i, j, value) {
        state.matrix[i][j] = Math.min(1, Math.max(0, parseFloat(value)));
    }

    function checkWeightsSum() {
        const sum = state.weights.reduce((a, b) => a + b, 0);
        const sumElement = document.getElementById('weight-sum');
        const isValid = Math.abs(sum - 1.0) < 1e-6;
        
        sumElement.textContent = sum.toFixed(4);
        sumElement.className = isValid ? 'valid-sum' : 'invalid-sum';
        
        document.getElementById('analyze-btn').disabled = !isValid;
        return isValid;
    }
    
    function switchTab(tab) {
        document.getElementById('input-tab').style.display = (tab === 'input' ? 'block' : 'none');
        document.getElementById('results-tab').style.display = (tab === 'results' ? 'block' : 'none');
        
        document.getElementById('tab-input-btn').classList.toggle('active', tab === 'input');
        document.getElementById('tab-results-btn').classList.toggle('active', tab === 'results');
    }

    // ----------------------------------------------------------------------------------
    // 4. LOGIQUE DE CONFIGURATION (TAILLE DE LA MATRICE)
    // ----------------------------------------------------------------------------------

    function showConfigModal() {
        document.getElementById('config-modal').style.display = 'flex';
        document.getElementById('num-criteria').value = state.nCriteria;
        document.getElementById('num-alternatives').value = state.nAlternatives;
    }

    function hideConfigModal() {
        document.getElementById('config-modal').style.display = 'none';
    }

    function applyChanges() {
        const newNCriteria = Math.max(2, Math.min(20, parseInt(document.getElementById('num-criteria').value) || state.nCriteria));
        const newNAlternatives = Math.max(2, Math.min(20, parseInt(document.getElementById('num-alternatives').value) || state.nAlternatives));
        
        // --- Mise √† jour des Crit√®res/Poids ---
        if (newNCriteria !== state.nCriteria) {
            state.nCriteria = newNCriteria;
            
            // Recr√©er les noms
            state.criterionNames = Array.from({ length: newNCriteria }, (_, i) => `C${i + 1}`);
            
            // Recr√©er les poids et normaliser (1/n)
            const newWeight = 1.0 / newNCriteria;
            state.weights = Array(newNCriteria).fill(newWeight);
            
            // Ajuster la matrice : ajouter/enlever des colonnes
            state.matrix = state.matrix.map(row => {
                const newRow = row.slice(0, newNCriteria);
                while (newRow.length < newNCriteria) {
                    newRow.push(0.5); // Valeur par d√©faut
                }
                return newRow;
            });
        }
        
        // --- Mise √† jour des Alternatives ---
        if (newNAlternatives !== state.nAlternatives) {
            state.nAlternatives = newNAlternatives;
            
            // Recr√©er les noms
            state.alternativeNames = Array.from({ length: newNAlternatives }, (_, i) => `A${i + 1}`);

            // Ajuster la matrice : ajouter/enlever des lignes
            while (state.matrix.length < newNAlternatives) {
                state.matrix.push(Array(state.nCriteria).fill(0.5)); // Nouvelle ligne par d√©faut
            }
            state.matrix = state.matrix.slice(0, newNAlternatives);
        }

        hideConfigModal();
        renderInputUI();
    }
    
    function resetData() {
        state.nCriteria = DEFAULT_CRITERIA_COUNT;
        state.nAlternatives = DEFAULT_ALTERNATIVES_COUNT;
        state.weights = [...DEFAULT_WEIGHTS];
        state.matrix = DEFAULT_MATRIX.map(row => [...row]);
        state.criterionNames = Array.from({ length: DEFAULT_CRITERIA_COUNT }, (_, i) => `C${i + 1}`);
        state.alternativeNames = Array.from({ length: DEFAULT_ALTERNATIVES_COUNT }, (_, i) => `A${i + 1}`);
        
        renderInputUI();
        switchTab('input');
        document.getElementById('tab-results-btn').disabled = true;
        document.getElementById('validation-error').textContent = '';
        document.getElementById('ranking-results').innerHTML = '';
        document.getElementById('sensitivity-results').innerHTML = '';
    }


    // ----------------------------------------------------------------------------------
    // 5. MOTEUR DE CALCUL DE SENSIBILIT√â (LOGIQUE DU PROMPT PR√âC√âDENT)
    // ----------------------------------------------------------------------------------

    function calculateScores(matrix, weights) {
        const nAlternatives = matrix.length;
        const scores = new Array(nAlternatives).fill(0);

        for (let i = 0; i < nAlternatives; i++) {
            for (let j = 0; j < weights.length; j++) {
                scores[i] += matrix[i][j] * weights[j];
            }
        }
        return scores;
    }

    function getRanking(scores, alternativeNames) {
        const ranking = scores.map((score, index) => ({
            score,
            alternative: alternativeNames[index],
            initialIndex: index,
            rank: 0,
        })).sort((a, b) => b.score - a.score);

        if (ranking.length > 0) {
            ranking[0].rank = 1;
            for (let i = 1; i < ranking.length; i++) {
                if (Math.abs(ranking[i].score - ranking[i - 1].score) < 1e-6) {
                    ranking[i].rank = ranking[i - 1].rank;
                } else {
                    ranking[i].rank = i + 1;
                }
            }
        }

        return ranking;
    }

    function calculateSensitivityBounds(matrix, weights, criterionIndex, initialRankingIndices) {
        const nAlternatives = matrix.length;
        const initialWk = weights[criterionIndex];
        const initialWsum = weights.reduce((sum, w) => sum + w, 0);

        if (Math.abs(initialWk - 1.0) < 1e-6 || Math.abs(initialWsum - 1.0) > 1e-6) {
            return [initialWk, initialWk];
        }

        const W_non_k_sum = initialWsum - initialWk;
        if (Math.abs(W_non_k_sum) < 1e-9) {
             return [0.0, 1.0];
        }

        const A = new Array(nAlternatives).fill(0);
        const B = new Array(nAlternatives).fill(0);
        
        for (let i = 0; i < nAlternatives; i++) {
            const V_i_k = matrix[i][criterionIndex];
            let Sum_V_W_non_k = 0;
            
            for (let j = 0; j < weights.length; j++) {
                if (j !== criterionIndex) {
                    Sum_V_W_non_k += matrix[i][j] * weights[j];
                }
            }
            
            const commonTerm = Sum_V_W_non_k / W_non_k_sum;
            A[i] = V_i_k - commonTerm;
            B[i] = commonTerm;
        }

        const optimalAlternativeIndex = initialRankingIndices[0];
        let lowerBound = 0.0;
        let upperBound = 1.0;

        for (let l = 0; l < nAlternatives; l++) {
            if (l === optimalAlternativeIndex) continue;

            const i = optimalAlternativeIndex;
            
            const numerator = B[l] - B[i];
            const denominator = A[i] - A[l];

            if (Math.abs(denominator) > 1e-9) { 
                const Wk_crit = numerator / denominator;

                if (denominator > 0) {
                    lowerBound = Math.max(lowerBound, Wk_crit);
                } else { 
                    upperBound = Math.min(upperBound, Wk_crit);
                }
            }
        }
        
        lowerBound = Math.max(0.0, lowerBound);
        upperBound = Math.min(1.0, upperBound);
        
        if (lowerBound > upperBound) {
            // Dans ce cas, l'ordre initial n'est possible qu'avec le point initial, ou c'est un probl√®me de pr√©cision.
            // On s'assure que l'intervalle est valide et contient le poids initial s'il est valide.
             if (lowerBound > initialWk && upperBound < initialWk) {
                return [initialWk, initialWk]; 
             } else {
                 return [Math.min(lowerBound, upperBound), Math.max(lowerBound, upperBound)];
             }
        }

        return [lowerBound, upperBound];
    }

    function validateAnalysisData(data) {
        const { matrix, weights } = data;
        const nAlternatives = matrix.length;
        const nCriteria = weights.length;

        if (nAlternatives < 2 || nCriteria < 2) {
            return { valid: false, error: "Minimum 2 crit√®res et 2 alternatives requis." };
        }
        
        const weightSum = weights.reduce((sum, w) => sum + w, 0);
        if (Math.abs(weightSum - 1.0) > 1e-6) {
            return { valid: false, error: `La somme des poids (${weightSum.toFixed(4)}) doit √™tre √©gale √† 1.0.` };
        }
        
        if (!matrix.every(row => row.length === nCriteria)) {
            return { valid: false, error: "Erreur de dimension de la matrice." };
        }

        if (!weights.every(w => w >= 0 && w <= 1) || !matrix.flat().every(v => v >= 0 && v <= 1)) {
            return { valid: false, error: "Toutes les valeurs doivent √™tre entre 0 et 1." };
        }

        return { valid: true };
    }


    function runAnalysis() {
        const validation = validateAnalysisData(state);
        const errorElement = document.getElementById('validation-error');
        
        errorElement.textContent = '';
        document.getElementById('tab-results-btn').disabled = true;

        if (!validation.valid) {
            errorElement.textContent = `Erreur de validation: ${validation.error}`;
            return;
        }

        // 1. Calcul des scores et classement initial
        const scores = calculateScores(state.matrix, state.weights);
        const ranking = getRanking(scores, state.alternativeNames);
        state.rankingResults = ranking;
        state.initialRankingIndices = ranking.map(r => r.initialIndex);
        
        // 2. Analyse de sensibilit√© pour chaque crit√®re
        const sensitivityResults = [];
        for (let k = 0; k < state.nCriteria; k++) {
            const [lb, ub] = calculateSensitivityBounds(state.matrix, state.weights, k, state.initialRankingIndices);
            const stabilityRange = parseFloat((ub - lb).toFixed(4));
            
            let robustness;
            if (stabilityRange > 0.5) {
                robustness = 'Tr√®s Robuste';
            } else if (stabilityRange > 0.2) {
                robustness = 'Robuste';
            } else {
                robustness = 'Sensible';
            }
            
            sensitivityResults.push({
                criterion: state.criterionNames[k],
                currentWeight: state.weights[k],
                lowerBound: parseFloat(lb.toFixed(4)),
                upperBound: parseFloat(ub.toFixed(4)),
                stabilityRange,
                robustness,
            });
        }
        state.sensitivityResults = sensitivityResults;

        // 3. Affichage des r√©sultats
        renderResults();
        document.getElementById('tab-results-btn').disabled = false;
        switchTab('results');
    }

    function renderResults() {
        // Classement
        let rankingHtml = '<table><thead><tr><th>Rang</th><th>Alternative</th><th>Score</th></tr></thead><tbody>';
        state.rankingResults.forEach(r => {
            rankingHtml += `<tr><td>${r.rank}</td><td>${r.alternative}</td><td>${r.score.toFixed(4)}</td></tr>`;
        });
        rankingHtml += '</tbody></table>';
        document.getElementById('ranking-results').innerHTML = rankingHtml;

        // Sensibilit√©
        let sensitivityHtml = '<table><thead><tr><th>Crit√®re</th><th>Poids Actuel</th><th>LB (Min)</th><th>UB (Max)</th><th>Zone de Stabilit√©</th><th>Robustesse</th></tr></thead><tbody>';
        state.sensitivityResults.forEach(r => {
            let robustClass;
            if (r.robustness === 'Tr√®s Robuste') robustClass = 'robust-high';
            else if (r.robustness === 'Robuste') robustClass = 'robust-medium';
            else robustClass = 'robust-low';
            
            sensitivityHtml += `<tr>
                <td>${r.criterion}</td>
                <td>${r.currentWeight.toFixed(4)}</td>
                <td>${r.lowerBound.toFixed(4)}</td>
                <td>${r.upperBound.toFixed(4)}</td>
                <td class="${robustClass}">${r.stabilityRange.toFixed(4)}</td>
                <td class="${robustClass}">${r.robustness}</td>
            </tr>`;
        });
        sensitivityHtml += '</tbody></table>';
        document.getElementById('sensitivity-results').innerHTML = sensitivityHtml;
    }

    function exportResults() {
        if (!state.rankingResults.length || !state.sensitivityResults.length) {
            alert("Veuillez effectuer l'analyse d'abord.");
            return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        
        // Ent√™te de la section Classement
        csvContent += "Classement Actuel\n";
        csvContent += "Rang;Alternative;Score\n";
        state.rankingResults.forEach(r => {
            csvContent += `${r.rank};${r.alternative};${r.score.toFixed(4)}\n`;
        });

        // Ent√™te de la section Sensibilit√©
        csvContent += "\nAnalyse de Sensibilit√©\n";
        csvContent += "Critere;Poids Actuel;Limite Inferieure (LB);Limite Superieure (UB);Zone de Stabilite;Robustesse\n";
        state.sensitivityResults.forEach(r => {
            csvContent += `${r.criterion};${r.currentWeight.toFixed(4)};${r.lowerBound.toFixed(4)};${r.upperBound.toFixed(4)};${r.stabilityRange.toFixed(4)};${r.robustness}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "analyse_sensibilite_mcda.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // ----------------------------------------------------------------------------------
    // 6. INITIALISATION
    // ----------------------------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        // Pour s'assurer que les donn√©es par d√©faut ont le bon format
        state.matrix = DEFAULT_MATRIX.map(row => [...row]);
        state.weights = [...DEFAULT_WEIGHTS];

        renderInputUI();
    });

</script>
</body>
</html>